/dts-v1/;

#include <st/f4/stm32f405Xg.dtsi>
#include <st/f4/stm32f405rgtx-pinctrl.dtsi>
#include "skoll.dtsi"
/*
things that we need to define:
PWM: buzzer, servo1, servo2, servo3, servo4 X
boot switch X
gpio: ledG, ledB, ledR, switch X
Oscillator (only Kconfig) X
SPI: MS5611, ICM20948 - add spi settings and icm20948 driver
battery sense X
can X
usb X
programming X

for each of the above I need to add: pinctrl, node (peripheral), setting, status, 
alias, chosen (?)
*/

/ {
    model = "Skoll Active Control System";
    compatible = "aesir,skoll";

    chosen{
		zephyr,flash = &flash0;
        zephyr,sram = &sram0;
        zephyr,spi2 = &spi2;
        zephyr,can1 = &can1;
    };

    aliases{
        spi2 = &spi2;
        can1 = &can1;
    };

    leds{
        compatible = "gpio-leds";

        led_green: led_green{
            gpios = <&gpiob 0 GPIO_ACTIVE_HIGH>;
        };

        led_blue: led_blue{
            gpios = <&gpiob 1 GPIO_ACTIVE_HIGH>;
        };

        led_red: led_red{
            gpios = <&gpiob 2 GPIO_ACTIVE_HIGH>;
        };
    };

    switches{
        compatible = "gpio-keys";

        switch_sense: switch_sense{
            gpios = <&gpioc 2 GPIO_ACTIVE_HIGH>;
        };
    };

    pwm {        
        servo1: servo1 {
            status = "okay";
            pwms = <&pwm1 1 PWM_MSEC(20) PWM_POLARITY_NORMAL>;
        };

        servo2: servo2 {
            status = "okay";
            pwms = <&pwm2 2 PWM_MSEC(20) PWM_POLARITY_NORMAL>;
        };

        servo3: servo3 {
            status = "okay";
            pwms = <&pwm3 3 PWM_MSEC(20) PWM_POLARITY_NORMAL>;
        };

        servo4: servo4 {
            status = "okay";
            pwms = <&pwm4 1 PWM_MSEC(20) PWM_POLARITY_NORMAL>;
        };

        buzzer: buzzer {
            status = "okay";
            pwms = <&pwm5 2 PWM_MSEC(10) PWM_POLARITY_NORMAL>; // will override period in code
        };
    };
};


&spi2{
    status = "okay";
	pinctrl-0 = <&spi2_sck_pb13 &spi2_miso_pb14 &spi2_mosi_pb15>;
	pinctrl-names = "default";

    ms5611: ms5611@0{
        compatible = "meas,ms5611";
        reg = <0>;
        status = "okay";
        cs-gpios = <&gpioa 4 GPIO_ACTIVE_LOW>;
        spi-max-frequency = <10000000>;
        // fix spi settings (look at driver?)
    };

    icm20948: icm20948@1{
        compatible = "invensense,icm20948"; // fix driver
        reg = <1>;
        status = "okay";
        cs-gpios = <&gpiob 12 GPIO_ACTIVE_LOW>;
        spi-max-frequency = <10000000>;
        // fix spi settings (look at driver?)
    };
};


